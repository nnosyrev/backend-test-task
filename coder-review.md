- Мне в принципе нравится идея на один action заводить отдельный класс (аля паттерн ADR https://api-platform.com/docs/symfony/controllers/), но для простого тестового задания пусть будет старый добрый MVC.
- Мне не нравится в ProductController идея получения категории путём самостоятельного разбора request-a. Пусть это делает фреймворк. А категория пусть будет указана в роуте.
- Мне не нравится идея самостоятельной работы с json и response-ами (тем более что это сделано как то очень странно - запись в поток происходит еще в контроллере до возврата response-а из контроллера). Пусть это делает фреймворк.
- В методе получения корзины всегда возвращается 404.
- Мне не нравится то что из ProductsView (из вьюхи) идёт обращение к репозиторию. По факту это нарушение MVC. Сделаем получение списка товаров по человечески в контроллере.
- При поиске товаров по категории из БД запрашиваем только id, а в коде используем и другие столбцы.
- В ProductRepository оба метода с SQL иньекциями (и похоже в запросах одинарные кавычки пропущены).
- Папке Entity не место в папке Repository.
- Если у нас Doctrine (судя по коду), то нужна нормальная Entity, без readonly.
- Если у нас Doctrine (судя по коду), то в коде нет причин заморачиваться с DBAL и самостоятельной гидратацией сущности. Пусть это делает доктрина.
- В создании таблицы product мне не нравится: поле id должно быть NOT NULL; поле uuid должно быть уникальным индексом и его длина не должна быть больше длины значений, чтобы индекс занимал меньше места; индекс is_active_idx не будет приносить профита, его можно удалить; столбец price должен быть DECIMAL; поле name не надо типа TEXT; не указана кодировка и движок;
- Категория товара в виде текстового столбца - не гуд. Нужна отдельная связанная таблица.
- Схема данных в виде sql файла - не гуд. Сделаем нормальную миграцию (генерится самой ORM).
- Банальные ошибки в коде работе с редисом.
- Хоть CartManager и про хранение данных, но мне не очень нравится, что он в папке репозиториев.
- Раз у нас API то должно быть stateless. Значит сессии у нас не будет. Пусть клиент шлёт сам свой ИД\хеш.
- В методе добавления в корзину нет сохранения.
- По моему paymentMethod в корзине не нужен. Он появится позже на этапе оформления заказа и будет фигурировать уже в сущности Заказ.
- По моему customer в корзине тоже не нужен. Ведь пользователь может начать добавлять, что то в корзину еще до регистрации.
- Возвращать 404 если в редисе нет корзины не правильно. Нужно возвращать пустую корзину.
- Я бы удалил из CartItem поля uuid, price. Так же бы удалил из данных корзины возвращаемых клиенту всякие цены и суммы. Пусть клиент это считает сам.
- Так же я бы не возвращал клиенту данные по товару из методов работы с корзиной. Для получения данных товара(-ов) по его Uuid(-ам), клиент должен будет дёргать другой метод API.
- Не очень понятно зачем нужен ConnectorException.
- Ответы методов API теперь просты, не содержат доп. логики и просто отражают структуру сущности или DTO из папки Domain. Нужды в файлах из папки View больше нет и можно обойтись каким то штатным сериалайзером.
- Зачем самому разбирать запрос, когда можно использовать какие то штатные средства.
- В файлах ConnectorFacade, Connector, CartManager что то сильно напутано и сделано не красиво. Перепишем и сделаем по другому.
- В текущей реализации, если в корзине есть позиция и при этом добавляется такая же позиция, то будет 2 разных записи. Переделал чтобы запись оставалась одна, но увеличивалось количество.
- Уберу readonly из контроллеров. Всё таки они не DTO и не VO.
- strict_types = 1 было не во всех файлах.
- Обкладывать код блоками try...catch и вызывать методы логирования тут не вижу смысла. В оригинальном коде так вообще было сделано по дурацки - в лог тупо писалось сообщение "Error". Неперехваченное исключение будет логироваться на уровне фреймворка.
